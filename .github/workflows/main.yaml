name: CI

# Controls when the workflow will run
on:
    push:
        branches: ["main"]

    # Allows you to run this workflow manually from the Actions tab
    workflow_dispatch:

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
    # This workflow contains a single job called "build"
    build:
        # The type of runner that the job will run on
        runs-on: ubuntu-latest

        # Steps represent a sequence of tasks that will be executed as part of the job
        steps:
            - uses: actions/checkout@v4
              with:
                  ref: "main"
                  # submodules: true # Fetch Hugo themes (true OR recursive)
                  fetch-depth: 0 # Fetch all history for .GitInfo and .Lastmod

            - name: Setup Hugo
              uses: peaceiris/actions-hugo@v3
              with:
                  hugo-version: "0.144.0"
                  extended: true

            - name: Build
              run: hugo --minify

            - name: Deploy
              uses: peaceiris/actions-gh-pages@v4
              # If you're changing the branch from main,
              # also change the `main` in `refs/heads/main`
              # below accordingly.
              if: github.ref == 'refs/heads/main'
              with:
                  github_token: ${{ secrets.PERSONAL_TOKEN }}
                  publish_dir: ./public
